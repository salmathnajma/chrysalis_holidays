!function(o,l,t,d){l.wp=l.wp||{},l.wp.gdrts=l.wp.gdrts||{},l.wp.gdrts.admin={storage:{url:"",row:0,progres:{active:!1,stop:!1,total:0,current:0,pages:0,step:50,settings:[]}},shared:{slug:function(t){o(".gdrts-field-slug",t).limitkeypress({rexp:/^[a-z0-9]*[a-z0-9\-\_]*[a-z0-9]*$/})}},init:function(){"about"===gdrts_data.page&&"addons"===gdrts_data.panel&&(wp.gdrts.admin.dialogs.changelog(),wp.gdrts.admin.addons.changelog.init()),"ratings"===gdrts_data.page&&(wp.gdrts.admin.dialogs.ratings(),wp.gdrts.admin.ratings.init()),"log"===gdrts_data.page&&(wp.gdrts.admin.dialogs.votes(),wp.gdrts.admin.votes.init()),"tools"===gdrts_data.page&&(wp.gdrts.admin.dialogs.votes(),wp.gdrts.admin.tools.init()),"types"===gdrts_data.page&&(wp.gdrts.admin.dialogs.types(),wp.gdrts.admin.types.init()),"settings"===gdrts_data.page&&wp.gdrts.admin.settings.init(),"rules"===gdrts_data.page&&(wp.gdrts.admin.dialogs.rules(),wp.gdrts.admin.rules.init(),wp.gdrts.admin.settings.init())},dialogs:{classes:function(t){var d="wp-dialog d4p-dialog gdrts-modal-dialog";return""!==t&&(d+=" "+t),d},defaults:function(){return{width:480,height:"auto",minHeight:24,autoOpen:!1,resizable:!1,modal:!0,closeOnEscape:!1,zIndex:3e5,open:function(){o(".gdrts-button-focus").focus()}}},icons:function(t){o(t).next().find(".ui-dialog-buttonset button").each(function(){var t=o(this).data("icon");""!==t&&o(this).find("span.ui-button-text").prepend(gdrts_data["button_icon_"+t])})},votes:function(){var t=o.extend({},wp.gdrts.admin.dialogs.defaults(),{dialogClass:wp.gdrts.admin.dialogs.classes("gdrts-dialog-hidex"),buttons:[{id:"gdrts-delete-del-delete",class:"gdrts-dialog-button-delete",text:gdrts_data.dialog_button_delete,data:{icon:"delete"},click:function(){o(".d4p-content-right form").submit()}},{id:"gdrts-delete-del-cancel",class:"gdrts-dialog-button-cancel gdrts-button-focus",text:gdrts_data.dialog_button_cancel,data:{icon:"cancel"},click:function(){o("#gdrts-dialog-log-delete").wpdialog("close")}}]}),d=o.extend({},wp.gdrts.admin.dialogs.defaults(),{dialogClass:wp.gdrts.admin.dialogs.classes("gdrts-dialog-hidex"),buttons:[{id:"gdrts-delete-rem-delete",class:"gdrts-dialog-button-delete",text:gdrts_data.dialog_button_remove,data:{icon:"delete"},click:function(){o(".d4p-content-right form").submit()}},{id:"gdrts-delete-rem-cancel",class:"gdrts-dialog-button-cancel gdrts-button-focus",text:gdrts_data.dialog_button_cancel,data:{icon:"cancel"},click:function(){o("#gdrts-dialog-log-remove").wpdialog("close")}}]}),a=o.extend({},wp.gdrts.admin.dialogs.defaults(),{dialogClass:wp.gdrts.admin.dialogs.classes("gdrts-dialog-hidex"),buttons:[{id:"gdrts-delete-delsingle-delete",class:"gdrts-dialog-button-delete",text:gdrts_data.dialog_button_delete,data:{icon:"delete"},click:function(){l.location.href=wp.gdrts.admin.storage.url}},{id:"gdrts-delete-delsingle-cancel",class:"gdrts-dialog-button-cancel gdrts-button-focus",text:gdrts_data.dialog_button_cancel,data:{icon:"cancel"},click:function(){o("#gdrts-dialog-log-delete-single").wpdialog("close")}}]}),e=o.extend({},wp.gdrts.admin.dialogs.defaults(),{dialogClass:wp.gdrts.admin.dialogs.classes("gdrts-dialog-hidex"),buttons:[{id:"gdrts-delete-remsingle-delete",class:"gdrts-dialog-button-delete",text:gdrts_data.dialog_button_remove,data:{icon:"delete"},click:function(){l.location.href=wp.gdrts.admin.storage.url}},{id:"gdrts-delete-remsingle-cancel",class:"gdrts-dialog-button-cancel gdrts-button-focus",text:gdrts_data.dialog_button_cancel,data:{icon:"cancel"},click:function(){o("#gdrts-dialog-log-remove-single").wpdialog("close")}}]});o("#gdrts-dialog-log-delete").wpdialog(t),o("#gdrts-dialog-log-remove").wpdialog(d),o("#gdrts-dialog-log-delete-single").wpdialog(a),o("#gdrts-dialog-log-remove-single").wpdialog(e),wp.gdrts.admin.dialogs.icons("#gdrts-dialog-log-delete"),wp.gdrts.admin.dialogs.icons("#gdrts-dialog-log-remove"),wp.gdrts.admin.dialogs.icons("#gdrts-dialog-log-delete-single"),wp.gdrts.admin.dialogs.icons("#gdrts-dialog-log-remove-single")},ratings:function(){var t=o.extend({},wp.gdrts.admin.dialogs.defaults(),{dialogClass:wp.gdrts.admin.dialogs.classes("gdrts-dialog-hidex"),buttons:[{id:"gdrts-delete-del-delete",class:"gdrts-dialog-button-delete",text:gdrts_data.dialog_button_delete,data:{icon:"delete"},click:function(){o(".d4p-content-right form").submit()}},{id:"gdrts-delete-del-cancel",class:"gdrts-dialog-button-cancel gdrts-button-focus",text:gdrts_data.dialog_button_cancel,data:{icon:"cancel"},click:function(){o("#gdrts-dialog-ratings-delete").wpdialog("close")}}]}),d=o.extend({},wp.gdrts.admin.dialogs.defaults(),{dialogClass:wp.gdrts.admin.dialogs.classes("gdrts-dialog-hidex"),buttons:[{id:"gdrts-delete-clr-delete",class:"gdrts-dialog-button-delete",text:gdrts_data.dialog_button_clear,data:{icon:"delete"},click:function(){o(".d4p-content-right form").submit()}},{id:"gdrts-delete-clr-cancel",class:"gdrts-dialog-button-cancel gdrts-button-focus",text:gdrts_data.dialog_button_cancel,data:{icon:"cancel"},click:function(){o("#gdrts-dialog-ratings-clear").wpdialog("close")}}]}),a=o.extend({},wp.gdrts.admin.dialogs.defaults(),{dialogClass:wp.gdrts.admin.dialogs.classes("gdrts-dialog-hidex"),buttons:[{id:"gdrts-delete-clrsingle-delete",class:"gdrts-dialog-button-delete",text:gdrts_data.dialog_button_delete,data:{icon:"delete"},click:function(){l.location.href=wp.gdrts.admin.storage.url}},{id:"gdrts-delete-clrsingle-cancel",class:"gdrts-dialog-button-cancel gdrts-button-focus",text:gdrts_data.dialog_button_cancel,data:{icon:"cancel"},click:function(){o("#gdrts-dialog-ratings-delete-single").wpdialog("close")}}]}),e=o.extend({},wp.gdrts.admin.dialogs.defaults(),{dialogClass:wp.gdrts.admin.dialogs.classes("gdrts-dialog-hidex"),buttons:[{id:"gdrts-delete-delsingle-delete",class:"gdrts-dialog-button-delete",text:gdrts_data.dialog_button_clear,data:{icon:"delete"},click:function(){l.location.href=wp.gdrts.admin.storage.url}},{id:"gdrts-delete-delsingle-cancel",class:"gdrts-dialog-button-cancel gdrts-button-focus",text:gdrts_data.dialog_button_cancel,data:{icon:"cancel"},click:function(){o("#gdrts-dialog-ratings-clear-single").wpdialog("close")}}]}),s=o.extend({},wp.gdrts.admin.dialogs.defaults(),{dialogClass:wp.gdrts.admin.dialogs.classes("gdrts-dialog-hidex"),buttons:[{id:"gdrts-delete-recsingle-delete",class:"gdrts-dialog-button-delete",text:gdrts_data.dialog_button_recalculate,data:{icon:"recalculate"},click:function(){l.location.href=wp.gdrts.admin.storage.url}},{id:"gdrts-delete-recsingle-cancel",class:"gdrts-dialog-button-cancel gdrts-button-focus",text:gdrts_data.dialog_button_cancel,data:{icon:"cancel"},click:function(){o("#gdrts-dialog-ratings-recalculate-single").wpdialog("close")}}]});o("#gdrts-dialog-ratings-delete").wpdialog(t),o("#gdrts-dialog-ratings-clear").wpdialog(d),o("#gdrts-dialog-ratings-delete-single").wpdialog(a),o("#gdrts-dialog-ratings-clear-single").wpdialog(e),o("#gdrts-dialog-ratings-recalculate-single").wpdialog(s),wp.gdrts.admin.dialogs.icons("#gdrts-dialog-ratings-delete"),wp.gdrts.admin.dialogs.icons("#gdrts-dialog-ratings-clear"),wp.gdrts.admin.dialogs.icons("#gdrts-dialog-ratings-delete-single"),wp.gdrts.admin.dialogs.icons("#gdrts-dialog-ratings-clear-single"),wp.gdrts.admin.dialogs.icons("#gdrts-dialog-ratings-recalculate-single")},types:function(){var t=o.extend({},wp.gdrts.admin.dialogs.defaults(),{dialogClass:wp.gdrts.admin.dialogs.classes("gdrts-dialog-hidex"),buttons:[{id:"gdrts-delete-del-delete",class:"gdrts-dialog-button-delete",text:gdrts_data.dialog_button_delete,data:{icon:"delete"},click:function(){l.location.href=wp.gdrts.admin.storage.url}},{id:"gdrts-delete-del-cancel",class:"gdrts-dialog-button-cancel gdrts-button-focus",text:gdrts_data.dialog_button_cancel,data:{icon:"cancel"},click:function(){o("#gdrts-dialog-entity-delete").wpdialog("close")}}]});o("#gdrts-dialog-entity-delete").wpdialog(t),wp.gdrts.admin.dialogs.icons("#gdrts-dialog-entity-delete")},changelog:function(){var t=o.extend({},wp.gdrts.admin.dialogs.defaults(),{dialogClass:wp.gdrts.admin.dialogs.classes(),width:640,height:400,buttons:[{id:"gdrts-delete-del-close",class:"gdrts-dialog-button-close gdrts-button-focus",text:gdrts_data.dialog_button_close,data:{icon:"cancel"},click:function(){o("#gdrts-dialog-about-changelog").wpdialog("close")}}]});o("#gdrts-dialog-about-changelog").wpdialog(t),wp.gdrts.admin.dialogs.icons("#gdrts-dialog-about-changelog")},rules:function(){var t=o.extend({},wp.gdrts.admin.dialogs.defaults(),{dialogClass:wp.gdrts.admin.dialogs.classes("gdrts-dialog-hidex"),buttons:[{id:"gdrts-delete-del-delete",class:"gdrts-dialog-button-delete",text:gdrts_data.dialog_button_delete,data:{icon:"delete"},click:function(){l.location.href=wp.gdrts.admin.storage.url}},{id:"gdrts-delete-del-cancel",class:"gdrts-dialog-button-cancel gdrts-button-focus",text:gdrts_data.dialog_button_cancel,data:{icon:"cancel"},click:function(){o("#gdrts-dialog-rule-delete").wpdialog("close")}}]});o("#gdrts-dialog-rule-delete").wpdialog(t),wp.gdrts.admin.dialogs.icons("#gdrts-dialog-rule-delete")}},addons:{changelog:{init:function(){o(t).on("click",".gdrts-addon-changelog-open",function(t){t.preventDefault();var d=o(this).next().html(),a=o(this).data("addon");o("#gdrts-dialog-about-changelog .gdrts-inner-content").html(d),o("#gdrts-dialog-about-changelog").wpdialog({title:gdrts_data.dialog_changelog+": "+a}),o("#gdrts-dialog-about-changelog").wpdialog("open")})}}},votes:{init:function(){o(".gdrts-action-delete-entry").click(function(t){t.preventDefault(),wp.gdrts.admin.storage.url=o(this).attr("href"),o("#gdrts-dialog-log-delete-single").wpdialog("open")}),o(".gdrts-action-remove-entry").click(function(t){t.preventDefault(),wp.gdrts.admin.storage.url=o(this).attr("href"),o("#gdrts-dialog-log-remove-single").wpdialog("open")}),o("#doaction").click(function(t){t.preventDefault(),"delete"===o("#bulk-action-selector-top").val()?o("#gdrts-dialog-log-delete").wpdialog("open"):"remove"===o("#bulk-action-selector-top").val()&&o("#gdrts-dialog-log-remove").wpdialog("open")}),o("#doaction2").click(function(t){t.preventDefault(),"delete"===o("#bulk-action-selector-bottom").val()?o("#gdrts-dialog-log-delete").wpdialog("open"):"remove"===o("#bulk-action-selector-bottom").val()&&o("#gdrts-dialog-log-remove").wpdialog("open")})}},ratings:{init:function(){o("#gdrts-ratings-submit").click(function(t){o("#bulk-action-selector-top, #bulk-action-selector-bottom").val(-1)}),o(".gdrts-action-clear-ratings").click(function(t){t.preventDefault(),wp.gdrts.admin.storage.url=o(this).attr("href"),o("#gdrts-dialog-ratings-clear-single").wpdialog("open")}),o(".gdrts-action-recalculate-ratings").click(function(t){t.preventDefault(),wp.gdrts.admin.storage.url=o(this).attr("href"),o("#gdrts-dialog-ratings-recalculate-single").wpdialog("open")}),o(".gdrts-action-delete-ratings").click(function(t){t.preventDefault(),wp.gdrts.admin.storage.url=o(this).attr("href"),o("#gdrts-dialog-ratings-delete-single").wpdialog("open")}),o("#doaction2").click(function(t){t.preventDefault(),"-1"!==o("#bulk-action-selector-bottom").val()&&("delete"===o("#bulk-action-selector-bottom").val()?o("#gdrts-dialog-ratings-delete").wpdialog("open"):o("#gdrts-dialog-ratings-clear").wpdialog("open"))}),o("#doaction").click(function(t){t.preventDefault(),"-1"!==o("#bulk-action-selector-top").val()&&("delete"===o("#bulk-action-selector-top").val()?o("#gdrts-dialog-ratings-delete").wpdialog("open"):o("#gdrts-dialog-ratings-clear").wpdialog("open"))})}},types:{init:function(){o(".gdrts-types-action-entity-delete").click(function(t){t.preventDefault(),wp.gdrts.admin.storage.url=o(this).attr("href"),o("#gdrts-dialog-entity-delete").wpdialog("open")})}},rules:{init:function(){o("select#object").change(function(){if(o(".gdrts-addon-methods-group").hide(),o(this).closest("form").find("input[type='submit']").attr("disabled",!1),"addon"===o(this).find(":selected").data("scope")){var t=".gdrts-addon-group-"+o(this).val();1===o(t).length&&(o(t).show(),"0"===o(t).find("select").val()&&o(this).closest("form").find("input[type='submit']").attr("disabled",!0))}}),o(".gdrts-action-delete-rule").click(function(t){t.preventDefault(),wp.gdrts.admin.storage.url=o(this).attr("href"),o("#gdrts-dialog-rule-delete").wpdialog("open")})}},tools:{init:function(){"export"===gdrts_data.panel&&wp.gdrts.admin.tools.export(),"recalc"===gdrts_data.panel&&wp.gdrts.admin.tools.recalc(),"dbfour"===gdrts_data.panel&&wp.gdrts.admin.tools.dbfour()},export:function(){o("#gdrts-tool-export").click(function(t){t.preventDefault(),l.location=o("#gdrts-export-url").val()})},dbfour:function(){o("#gdrts-tool-dbfour").click(function(t){wp.gdrts.admin.storage.progres.active?wp.gdrts.admin.dbfour.stop():wp.gdrts.admin.dbfour.start()})},recalc:function(){wp.gdrts.admin.storage.progres.step=gdrts_data.step_recalculate,o("#gdrts-tool-recalc").click(function(t){if(wp.gdrts.admin.storage.progres.active)wp.gdrts.admin.recalculation.stop();else{var d=o(".gdrts-recalc-filter:checked"),a=[];0===d.length?alert(gdrts_data.dialog_nothing):(o.each(d,function(t,d){a.push(o(d).val())}),wp.gdrts.admin.recalculation.start(a))}})}},dbfour:{start:function(){wp.gdrts.admin.storage.progres.active=!0,o("#gdrts-tool-dbfour").val(gdrts_data.button_stop),o("#gdrts-dbfour-intro").slideUp(),o("#gdrts-dbfour-process").slideDown(),wp.gdrts.admin.dbfour._call({operation:"start"},wp.gdrts.admin.dbfour.callback_start)},stop:function(){wp.gdrts.admin.storage.progres.stop=!0,o("#gdrts-tool-dbfour").attr("disabled",!0)},callback_start:function(t){wp.gdrts.admin.storage.progres.total=t.objects,wp.gdrts.admin.storage.progres.pages=t.objects,wp.gdrts.admin.dbfour._write(t.message),wp.gdrts.admin.dbfour.run()},callback_stop:function(t){wp.gdrts.admin.storage.progres.active=!1,wp.gdrts.admin.dbfour._write(t.message)},callback_process:function(t){wp.gdrts.admin.storage.progres.stop?wp.gdrts.admin.dbfour._call({operation:"break"},wp.gdrts.admin.dbfour.callback_stop):(wp.gdrts.admin.storage.progres.current+=t.done,wp.gdrts.admin.dbfour._write(t.message),wp.gdrts.admin.storage.progres.current<wp.gdrts.admin.storage.progres.pages?wp.gdrts.admin.dbfour.run():(wp.gdrts.admin.dbfour.stop(),wp.gdrts.admin.dbfour._call({operation:"stop"},wp.gdrts.admin.dbfour.callback_stop)))},run:function(){var t={operation:"run",total:wp.gdrts.admin.storage.progres.total,current:wp.gdrts.admin.storage.progres.current};wp.gdrts.admin.dbfour._call(t,wp.gdrts.admin.dbfour.callback_process)},_write:function(t){o("#gdrts-dbfour-progress pre").append(t+"\r\n")},_call:function(t,d){o.ajax({url:ajaxurl+"?action=gdrts_tools_dbfour&_ajax_nonce="+gdrts_data.nonce,type:"post",dataType:"json",data:t,success:d})}},recalculation:{start:function(t){wp.gdrts.admin.storage.progres.active=!0,wp.gdrts.admin.storage.progres.settings=t,o("#gdrts-tool-recalc").val(gdrts_data.button_stop),o("#gdrts-recalc-intro").slideUp(),o("#gdrts-recalc-process").slideDown(),wp.gdrts.admin.recalculation._call({operation:"start"},wp.gdrts.admin.recalculation.callback_start)},stop:function(){wp.gdrts.admin.storage.progres.stop=!0,o("#gdrts-tool-recalc").attr("disabled",!0)},callback_start:function(t){wp.gdrts.admin.storage.progres.total=t.objects,wp.gdrts.admin.storage.progres.pages=Math.ceil(t.objects/wp.gdrts.admin.storage.progres.step),wp.gdrts.admin.recalculation._write(t.message),wp.gdrts.admin.recalculation.run()},callback_stop:function(t){wp.gdrts.admin.storage.progres.active=!1,wp.gdrts.admin.recalculation._write(t.message)},callback_process:function(t){wp.gdrts.admin.storage.progres.stop?wp.gdrts.admin.recalculation._call({operation:"break"},wp.gdrts.admin.recalculation.callback_stop):(wp.gdrts.admin.storage.progres.current++,wp.gdrts.admin.recalculation._write(t.message),wp.gdrts.admin.storage.progres.current<wp.gdrts.admin.storage.progres.pages?wp.gdrts.admin.recalculation.run():(wp.gdrts.admin.recalculation.stop(),wp.gdrts.admin.recalculation._call({operation:"stop"},wp.gdrts.admin.recalculation.callback_stop)))},run:function(){var t={operation:"run",total:wp.gdrts.admin.storage.progres.total,current:wp.gdrts.admin.storage.progres.current,step:wp.gdrts.admin.storage.progres.step,settings:wp.gdrts.admin.storage.progres.settings};wp.gdrts.admin.recalculation._call(t,wp.gdrts.admin.recalculation.callback_process)},_write:function(t){o("#gdrts-recalc-progress pre").prepend(t+"\r\n")},_call:function(t,d){o.ajax({url:ajaxurl+"?action=gdrts_tools_recalc&_ajax_nonce="+gdrts_data.nonce,type:"post",dataType:"json",data:t,success:d})}},settings:{init:function(){o(".gdrts-style-type-selection select").change(function(t){var d=o(this).val();o(".gdrts-select-type").removeClass("gdrts-select-type-show"),o(".gdrts-sel-type-"+d).addClass("gdrts-select-type-show")})}}},wp.gdrts.admin.init()}(jQuery,window,document);